---
title: HotwireとReactの複雑性
layout: article
order: 50
---

## HotwireとReactの偶有的複雑性

複雑さには[偶有的な複雑性(accidental complexity)](https://ja.wikipedia.org/wiki/銀の弾などない)と[本質的な複雑性(essential complexity)](https://ja.wikipedia.org/wiki/銀の弾などない)があります。そして偶有的な複雑性は退治できますが、本質的な複雑性は容易にはなくせず、正面から剥き圧必要があります。

ここではReactの偶有的な複雑性を確認し、Hotwireによって何が取り除かれるかを確認します。逆にHotwireの方が複雑な側面も確認します。

## Reactの偶有的複雑性

偶有的は実装上の複雑性を指します。ビジネスや要求仕様上の複雑性は本質的な複雑性と捉え、それを実現するためのソフトウェア上の複雑性を偶有的複雑性と考えます。つまり、完全に無くしても良いものが偶有的複雑性ということになります。

### JSON APIは偶有的複雑性

サーバとブラウザを繋げるJSON APIは明確に偶有的複雑性です。

* 大半のケースではブラウザにHTMLを直接送れば十分なUI/UXが実現できます
* Next.js, Remix等では明示的なJSON APIは存在しません。またReact Server ComponentsではJSON APIがありません

ただしいつでもJSON APIが常に省略できるとは限りません。ネットワークが遮断されてもある程度操作したいアプリの場合は、ブラウザ側でモデルを持つ必要があります。そのようなケースではHTMLではなく、抽象度が高いJSONとしてサーバとデータをやり取りする必要があるでしょう。

なおネイティブアプリであってもWebViewを使ってサーバから送られてきたUIを表示できますので、それだけではJSON APIが必要とは言えません

### Hydrationは偶有的複雑性

Hydrationはブラウザに表示されているHTMLにイベントハンドラ等を繋げて、インタラクティブにする過程です。

HTML/JSは元々が独立できるように設計されており、長くこれがベストプラクティスとされていました。したがってHTMLとJSが別ファイルとしてブラウザに送られ、ブラウザの中でHTMLとJSを接続するのは元来から備わっている機能です。

React SSRでHydrationが必要になるのは、ReactがブラウザネイティブのHTML/JSとは異なるアプローチをとっているためだけです。

### Controlled formは偶有的複雑性

HTMLの`<form>`や`<input>`は元来から内部ステートを持っており、ユーザの操作は自動的に内部ステートと同期されます。ReactでよくやるControlled formは不必要です。

### クライアントルーティングは偶有的複雑性

ルーティングとはURLに応じて適切な内容のページを表示する機能です。HTTPは元々からこのように設計されています。ブラウザのネイティブな機能だけで十分に満たせます。

### CSRは偶有的複雑性

Reactは原則としてブラウザの中でHTMLをレンダリングします。元来であればサーバがHTMLをレンダリングしていたのを、ブラウザで行うわけです。そのメリットは、ダイナミックにHTMLを書き換えられることです。

しかしブラウザは元来、HTMLを静的なものとして扱っていました。そして表示の変更はネイティブは`<input>`タグやCSSを使って行いました。大きくHTMLを書き換える場合は、サーバでレンダリングされたHTMLをもらうようにできています。

実際、ダイナミックに行うインタラクションの大半はCSSクラスの変更等で十分にまかなえます。HTMLを大きく変えるためにCSRでページ全体を書き換えるのは、かなりオーバーキルです。


## Hotwireの複雑性

HotwireはHTML/JSの伝統に基づいて、HTMLとJavaScriptは原則として別々に考えます。したがって、JavaScriptで画面表示を制御したい場合はHTMLとJSを繋げる必要があります。これはHTMLのレンダリングと別に行います。

一方でReactの特徴は、（少なくともDX的には）HTMLの記述とJavaScriptのイベントハンドラを一緒に書くことです。 HTMLとJSの密結合をしています。

一般論として、密結合をした書き方の方がわかりやすいことがあります。ReactもHTMLとJSを密結合させることで機能単位としての分割が容易になっています（コンポーネント化）。

それに対してHotwireは、すでにサーバ側でレンダリングされたHTMLに対してJavaScriptを繋げていきます。`data-controller`、`data-*-target`や`data-action`の属性がこれを主に担います。

ただしHotwireは、HTMLを見ればどのJavaScriptが呼び出されているかは明確になるように工夫されています。IDEのコードジャンプが効かないぐらいの不便さで収まっています。

### 描画ロジックをどこに書くか？

Reactの場合は、[条件付きランダー](https://ja.react.dev/learn/conditional-rendering)のパターンでJSXの中に条件分岐を書き込みます。ロジックがHTMLテンプレートの中に記述されてしまう問題点はありますが、わかりやすい書き方です。

それ対してHotwireの場合、JavaScriptでHTMLを条件によって書き分ける場合はStimulus Controllerの中に記述します。ロジックとHTMLテンプレートが分かれている面はプラスですが、コードは少しわかりにくくなります。

### Hotwireの方がCSSは使う

Hotwireの場合はなるべくHTMLを直接書き換えませんので、CSSを使って表示を切り替えます。CSSクラスを直接書き換えずに、CSSの擬似セレクタなどを使用してStimulusの`values`ステートや`aria`属性に反応させるようにします。この点は、直接HTMLを書き換えることが多いReactと大きく異なります。CSSの機能をより活用することになりますので、より複雑なCSSを使うことになります。
