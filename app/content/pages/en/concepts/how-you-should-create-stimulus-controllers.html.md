---
title: Stimulus Controllerの作り方
layout: article
order: 050
---

## `bin/rails g stimulus [controller名]`

Railsのたいていのものはコピペで作れます。例えばRailsのControllerを増やすときは、すでにあるコントローラをコピペして、名前を何箇所か変更するだけで十分です。常に`bin/rails g controller [controller名]`とはしません。

しかしStimulusの場合は、常に`bin/rails g stimulus [controller名]`でcontrollerを増やすべきです。Stimulus Controllerをコピペしただけでは、読み込まれないことがあるためです。以下に解説します

## controllerの自動ロード

Stimulus controllerは`app/javascript/controllers`フォルダに置きます。Railsデフォルトの[import map](https://github.com/rails/importmap-rails)、もしくはWebpackでビルドして[Stimulus webpack helpers](https://www.npmjs.com/package/@hotwired/stimulus-webpack-helpers)を使っているときは、このフォルダに配置されたStimulus controllerは自動的に読み込まれます。

しかしそれ以外のビルドシステムを使っている場合（例えば[jsbundling-rails](https://github.com/rails/jsbundling-rails)で[esbuild](https://esbuild.github.io)を使用している場合）は、自動ローディングしてくれません。

この場合は`app/javascript/controllers/index.js`に各コントローラを登録する必要があります。`bin/rails g stimulus [controller名]`をすると、この辺りを自動的にやってくれます。また作りそびれた場合は後で`bin/rails stimulus:manifest:update`とやれば作り直してくれます。

詳しくは[公式ドキュメント](https://stimulus.hotwired.dev/handbook/installing#using-other-build-systems)をご確認ください。

```js:app/javascript/controllers/index.js
// This file is auto-generated by ./bin/rails stimulus:manifest:update
// Run that command whenever you add a new controller or create them with
// ./bin/rails generate stimulus controllerName

import { application } from "./application"

import AccordionController from "./accordion_controller"
application.register("accordion", AccordionController)

// ...
```

## まとめ --- summary

* Webpackではないビルドシステムを使用している場合は `app/javascript/controllers/index.js`に新しいcontrollerを登録する必要があります。`bin/rails g stimulus [controller名]`ならこれを自動的にやってくれますので、なるべくこのコマンドで作ってください
* なおimport mapsやWebpackを使っている場合はこの限りではないのですが、なるべく統一した方が良いと思いますので、その時も`bin/rails g stimulus [controller名]`を使うことをお勧めします
* 作りそびれた場合は`bin/rails stimulus:manifest:update`をやれば、自動的に登録をアップデートしてくれます
